\documentclass[12pt,a4paper]{report}

\usepackage[french]{babel}
\usepackage[applemac]{inputenc}
%\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}

\usepackage[final]{pdfpages}
\usepackage[cm]{fullpage}

\usepackage{url}
%\usepackage{textcomp}		%caractËres spÈciaux
\usepackage{graphicx}

\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}
\newcommand{\jasmed}{\texttt{JaSMEd}}

\begin{document}

\input{./couverture.tex}

{\huge \center
Sujet PSAR Master 2011-2012\\[2cm]
Editeur musical collaboratif en JavaScript
}\\[3cm]

La nouvelle interface WebSocket permet d’utiliser les navigateurs pour implémenter facilement en JavaScript des applications collaboratives et interactives. Ajoutée à la nouvelle interface WebAudio, on peut en particulier concevoir un éditeur de pîstes musicales affiché par un navigateur Web standard, sur lequel opère à la fois l’utilisateur du navigateur et ses correspondants.\\

Le but du projet est de développer un tel éditeur, en traitant en particulier les problèmes d’accès concurrents à une même partie des pistes musicales éditées collaborativement. Se pose aussi la question de l’archivage sur le serveur des différents états de la partition, et la manière d’y accéder.\\

La question des protocoles audio à utiliser sera aussi abordée.

\tableofcontents

\chapter{Introduction}

Nous avons proposé \jasmed\ car il s'inscrit à la fois dans le domaine des applications réparties, et reflète nos orientations musicales dans la pratique de l'informatique.
C'est dans un cadre internet en constante transformation que l'on a développé \jasmed, une application client/serveur qui tire partie des nouvelles API d’HTML5.\\

\jasmed\ est un éditeur musical multi-utilisateur temps réel implémenté à partir des nouveaux standards du web qui tire sa spécificité de part son approche de composition polyrythmique~\footnote{Superposition de plusieurs parties ayant chacune un rythme différent et dont les accents d'appui ne coïncident pas entre eux (Larousse de la Musique, Paris, t. 2, 1982, p. 1247).}.\\
Actuellement il n'existe pas d'outils pour créer une polyrythmie musicale de manière collaborative. En général il n'y a pas de moyens simples permettant d'écrire ce genre de rythmes complexes, et encore moins sur internet où la majeure partie des applications musicales ne sont pas de véritables outils de composition.\\
C'est en faisant ce constat que nous est apparue l'idée de développer \jasmed.
De part son approche de l'édition web collaborative, notre travail s'inscrit parfaitement dans le cadre du master SAR \footnote{Systèmes et Applications Répartis}.\\
Il faut préciser que c'est une application non encore aboutie que nous présentons ici, elle est fonctionnelle mais mais ne représente pas encore complètement l'ampleur du projet.\\

Nous avons eu la chance de proposer notre propre projet à Emmanuel Saint-James, nous avons constamment cherché à nous recentrer et nous concerter avec notre professeur référent.

%démarche inrérêt proposition domaine de l'audio apllications informatique répartie

\chapter{Etat de l'art}

Le HTML est le langage principal du World Wide Web, le W3C\footnote{World Wide Web Consortium} est actuellement entrain de travailler sur HTML5, qui est la 5ème révision majeure de ce langage. Il est important de noter que cette version est toujours à l'état d'ébauche~\footnote{\url{http://www.w3.org/TR/html5/index.html}} et ne cesse d'évoluer.
HTML5 fournit une flopée de nouvelles API, notamment la balise <audio>~\footnote{\url{http://www.whatwg.org/specs/web-apps/current-work/multipage/the-video-element.html#the-audio-element}} qui permet de fournir un lecteur audio simple, et enfin de se passer des vieux lecteurs et codecs lourds et privés (Windows media player, realPlayer, quicktime).
Malheureusement ce n'est pas suffisant pour un traitement de l'audio plus poussé, c'est ainsi que des librairies audio ont fait leur apparition.

\medskip
Les navigateurs Firefox et Google Chrome ont ainsi développé leur propre API audio, permettant de véritablement traiter le signal numérique sur nos navigateurs.
Ces API ont été crées dans le but d'offrir au web game developer un vrai environnement sonore pour la conception de jeu sur le web, dans la synergie avec la sortie du WebGL.\\
WebAudio est un peu plus poussée que Firefox, de même elle bénéficie d'un plus grand engouement dans la communauté web. D'après les listes de diffusion du working draft du W3C, l'API de Google serait même candidate à une standardisation imminente.

WebAudio, largement inspiré du sytème CoreAudio d'Apple, pour Google Chrome
Audio Data Api pour firefox

\medskip
Il existe déjà beaucoup de librairies javascript qui abstraient ces API et permettent de construire des applications audio sur le web plus facilement~\footnote{\url{https://wiki.mozilla.org/Audio_Data_API#JavaScript_Audio_Libraries}}.
Certaines, comme audiolib.js\cite{audiolib} ou audionode.js, permettent d'abstraire les différences entre les 2 API concurrentes et ainsi grandement faciliter la portabilité entre navigateurs. \\

Une quantité de nouvelles applications web musicales sont apparues sur la toile avec l'arrivée d'HTML5. La majeure partie de ces applications ont un aspect ludique (ou se bornent à être de simples gadgets) , et ne sont pas vraiment utiles à des compositeurs/musiciens. On en a recensé un échantillon : 
\begin{itemize}
\item jeux sonores
\item éditeur musical
\end{itemize}\\

Si on regarde les logiciels d'édition musicale ils ne permettent pas de créer facilement des musiques poly-rythmiques, mais se prettent plus facilement à composer des tempos binaires. Les plus connus d'entre eux :\\
Ableton Live\\
\url{http://harmonyseq.wordpress.com/}\\
\url{http://www.technitone.com/#}\\

Notre projet s'inscrit donc au coeur des avancées actuelles du web dans le domaine de l'audio, et il propose une vision d'édition poly-rythmique peu répandue dans les logiciels audio.

\chapter{Conception}
\section{Général}
L’idée est de se détacher des notations solfégiques usuelles pour s’orienter vers une écriture musicale plus ludique et intuitive, adaptée notamment aux enfants. Dans ce but, nous nous sommes émancipé de la signature rythmique et avons imaginé une division en blocs (aparentable à des mesures). Tous les blocs ont une durée identique, et sont indépendamment subdivisibles (un bloc s’apparente à une mesure avec une signature et une vitesse d’exécution adapté).\\

le client s’exécute sur un navigateur web, la synthèse du son étant gérée par l’API audiolib ;
la communication temps-réel entre les deux parties s’effectue via le protocole webSocket.\\
Le serveur utilise nodejs, une librairie JavaScript ajoutant la programmation évenementielle au langage.\\
Plusieurs clients peuvent éditer une unique piste musicale de manière concurrente.\\
Le programme client offre divers outils d’édition et de lecture du morceau, tandis que le serveur s’occupe de la communication entre les différents éditeurs et de la sauvegarde des données.

\section{Modularité}

\section{Concurrence}

\includegraphics[width=\linewidth]{./PSAR-Client}

L’utilisateur peut ainsi construire un morceau en accolant des blocs et en spécifiant pour chacun le nombre de temps égaux à insérer dans celui-ci. De cette manière, il est possible de reproduire toute construction rythmique (à la manière des constructions LEGO).\\
Un même bloc peut être composé de différents “calques”, un calque représentant ce bloc avec une subdivision particulière : cela permet d’éditer simplement de la polyrythmie.\\ 

\chapter{Choix d'implémentation}

Les technologies que nous avons utilisées pour ce projet ont été le fruit d'une curiosité des technologies actuelles et d'un constant effort de remise en question.

\section{Confort de développement}

Nous avons cherché à travailler en groupe de la meilleure façon possible, en nous servant d'outils utiles aux programmateurs souhaitant travailler en groupe. \\
Dès les premières semaines nous avons insisté sur la recherche d'outils collaboratifs permettant au groupe de travailler et de partager ce travail de la meilleure manière qui soit.\\
Tous les documents écrits ont été partagées et rédigées sous Google docs.\\
Notre application a été développée avec le gestionnaire de version Git.\\
Nous avons hébergé notre code sur le serveur Github, qui est un site web très actif et où l'on retrouve la majorité des projets informatiques issus du monde du libre.\\
cloud9 est un éditeur javascript écrit avec node.js\\

Tous le code de l'application est correctement commenté, et est rédigé en anglais pour permettre au plus grand nombre de suivre le développement sur gitHub.

\section{JavaScript}

JavaScript est le langage de programmation du Web. L'écrasante majorité des sites Web modernes l'utilisent, et tous les navigateurs web modernes possèdent leur interpréteur JavaScript, ce qui rend ce langage de programmation le plus répandu dans l'histoire. 
JavaScript est une partie de la triade des technologies que tous les développeurs Web doivent apprendre avec HTML et CSS.
Il permet de spécifier le comportement de pages Web.\\
JavaScript est un langage de programmation de haut niveau, dynamique, non typé, interprété qui est bien adapté à des styles de programmation orientée objet et fonctionnelle.\\
Le nom de «JavaScript» est en fait quelque peu trompeur. Sauf pour une superficielle syntaxique ressemblance, JavaScript est complètement différent du langage de programmation Java. JavaScript est un langage solide et efficace qui peut répondre à des fins générales. 
La dernière version définit de nouvelles fonctionnalités pour le développement de gros logiciels à grande échelle.\\

Toutes les librairies ci-dessous, aussi bien du côté client que du côté serveur, sont écrites en JavaScript.

\section{Client}

jQuery\\
jQuery sert à faciliter les tâches JavaScript les plus communes, et cacher la différence qu'il existe entre les différents navigateurs.
Elle permet de trouver et de manipuler simplement les éléments du DOM, de manipuler les attributs HTML et les propriétés CSS.\\
Beaucoup de programmeurs web utilisent jQuery pour sa petite taille et sa stabilité, ce qui en fait actuellement une des librairies JavaScript les plus populaire.
L'objet jQuery est souvent utilisé, il est donc accessible dans le code par "\$".\\

Underscore.js\\
Underscore est une librairie qui fournit un tas d'outils pour la programmation fonctionnelle.\\
L'objet Underscore est accessible dans le code par "\_".\\

Backbone\\
Backbone permet de construire une structure solide pour les applications Web avec une interface utilisateur complexe.
Elle repose sur une architecture MVC.\\
Backbone dépend fortement de Underscore.js.\\

Socket.iIO\\
Socket.IO permet d'écrire des applications temps réel.\\

audiolib.js\\
Cette librairie audio fournit un moyen de générer et jouer du son en assurant l'inter-opérabilité entre les API audio respectives des navigateurs Firefox et Chrome.
Son développeur est très actif et elle est bien suivie par la communauté, elle fournit aussi beaucoup d'outils de synthèse sonore visant à simplifier le travail du programmeur.

\section{Serveur}
Le serveur centralise et re-distribue les messages d’utilisateurs travaillant dans la même salle - sur le même morceau - tout en gérant les collisions éventuelles.
Il implante deux protocoles réseaux :
\begin{itemize}
\item HTTP pour l’initialisation de l’application et le chargement de morceaux ;
\item Websocket pour toutes les modifications temps-réel effectués par les clients.
\end{itemize}

\chapter{Avancement}

\section{Etat actuel de l'outil}


\section{Détails techniques}

\chapter{Manuel d'utilisation}

Ce manuel présente les possibilités offertes à l'utilisateur pour la version actuelle de \jasmed.\\

Tout d'abord, un utilisateur doit d'abord être authentifié par le serveur pour pouvoir accéder à une session.
Pour rajouter un utilisateur, il faut éditer le fichier authentification.js.\\
Une fois identifié il peux se rendre sur la page principale et commencer à éditer.\\
L'application fournit à l’utilisateur des outils d’édition, de lecture,  d’instrumentation, et représente graphiquement la piste en cours d’édition.

\includegraphics[width= \linewidth]{./track}

\section{Édition}
La partie édition représente une partition musicale à éditer/jouer, spécifiant la hauteur, la longueur, et la position de chaque note. L’éditeur permet la navigation verticale et horizontale : horizontalement sur l’axe du temps et verticalement selon la hauteur du son.\\
L'utilisateur peut faire défiler l'éditeur horizontalement en mettant son pointeur de souris près du bord d'un des blocs situés aux extrémités, ou verticalement avec la barre de défilement.

\medskip
On peut ajouter un layer à un bloc en entrant le nombre de subdivision voulu dans la zone rectangulaire (avec un +) au dessus de celui-ci.
On peut ensuite changer le layer apparent du bloc en cliquant sur le bouton correspondant.

\medskip
Pour créer une note qui aura la durée voulue, il faut d'abord sélectionner/créer le bon layer puis cliquer sur une case du bloc.
Il est possible de cliquer sur une case et relâcher la souris sur une case suivante de la même hauteur pour pouvoir créer une note plus longue.\\
Pour l'instant on ne peut pas supprimer de notes, pour commencer une nouvelle session il faut recharger la page.

\section{Lecture}
Les outils de lecture sont simplement constitués de trois boutons :
\begin{itemize}
\item play
\item pause
\item stop
\end{itemize}
    
\section{Outils}
L'utilisateur peut exporter son morceau sur le serveur (l'enregistrer) en lui donnant un nom dans la zone sous "export as", puis en appuyant sur le bouton "BANG!".
On peut agrandir ou rétrécir la taille des blocs dans la zone d'édition avec les boutons zoom in et zoom out.
Si on veut rajouter un bloc à notre piste on clique sur le bouton add block.
    
\section{Instrumentation}
Le panneau d’instrumentation permet de choisir le type de l'oscillateur qui jouera la piste lors de la lecture, ainsi que de modifier l'intensité du sustain de l'enveloppe ADSR en bougeant le slider.

\chapter{Conclusion}
pouvoir changer le tempo\\
plus d'interaction avec l'instrument\\
gérer les collisions\\


\begin{thebibliography}{99}

\bibitem{Flanagan}
  David Flanagan,
  \emph{JavaScript: The Definitive Guide}.
  \\O'Reilly,
  2011.

\bibitem{audiolib}
Jussi Kalliokosky,
\emph{Audio Library Application Programming Interface}.\\
\url{https://github.com/jussi-kalliokoski/audiolib.js}

\bibitem{draft}
W3C (,
\emph{Audio Library Application Programming Interface}.\\
\url{https://github.com/jussi-kalliokoski/audiolib.js}

\end{thebibliography}

\appendix

\chapter*{Diagramme de l'architecture}
\includegraphics[width=\linewidth]{./jasmedDirectory}

\chapter*{Messages échangés}

\end{document}

pb et difficultés:
-MIDI (chap conception)
-largeur de bloc ->affichage non-cohérent, curseur de lecture
-sample décalage
-app scalable -> modulaire/gestion centralisé, MV*
-latence d'initialisation lecture